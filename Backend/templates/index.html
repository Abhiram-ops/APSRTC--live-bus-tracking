<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=3.0">
    <title>APSRTC Vizag</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/style.css">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="container-fluid">
            <span class="navbar-brand">
                <i class="bi bi-bus-front-fill"></i> APSRTC Live
            </span>
            <div class="d-flex align-items-center">
                <a href="/driver" class="text-white-50 text-decoration-none small me-3"><i
                        class="bi bi-person-badge"></i> Driver</a>
                <span class="small text-white-50">Vizag City</span>
            </div>
        </div>
    </nav>

    <div class="app-container">

        <!-- TABS -->
        <ul class="nav nav-tabs nav-fill">
            <li class="nav-item">
                <a class="nav-link active" onclick="switchTab('search')"><i class="bi bi-search"></i> Search</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="switchTab('routes')"><i class="bi bi-map"></i> Routes</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick="switchTab('track')"><i class="bi bi-geo-alt"></i> Track</a>
            </li>
        </ul>

        <!-- TAB CONTENT: SEARCH -->
        <div id="tab-search" class="fade-in">
            <div class="card-box">
                <div class="section-title">Bus Ticket Search</div>

                <form id="ticketForm">
                    <datalist id="stationList"></datalist>

                    <div class="mb-3">
                        <label class="form-label small text-muted">From</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><i
                                    class="bi bi-circle text-success"></i></span>
                            <input type="text" id="ticketFrom" list="stationList" class="form-control border-start-0"
                                placeholder="Source Station" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small text-muted">To</label>
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0"><i
                                    class="bi bi-geo-alt text-danger"></i></span>
                            <input type="text" id="ticketTo" list="stationList" class="form-control border-start-0"
                                placeholder="Destination Station" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <select id="ticketService" class="form-select">
                            <option value="">Any Service Type</option>
                            <option value="express">Express</option>
                            <option value="metro">Metro</option>
                            <option value="deluxe">Deluxe</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> Find Buses
                    </button>
                </form>
            </div>

            <!-- SEARCH RESULTS -->
            <div id="ticketResult"></div>
        </div>

        <!-- TAB CONTENT: ROUTES -->
        <div id="tab-routes" class="fade-in" style="display: none;">
            <div class="card-box">
                <div class="section-title">All Available Routes</div>
                <div class="d-grid gap-2">
                    <button id="viewRoutesBtn" class="btn btn-outline-danger">Load All Routes</button>
                    <div id="routesResult" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- TAB CONTENT: TRACKING -->
        <div id="tab-track" class="fade-in" style="display: none;">
            <div class="card-box">
                <div class="section-title">Live Tracking</div>

                <div class="toggle-wrapper" id="trackingToggle">
                    <div class="toggle-option active" data-type="service">By Service</div>
                    <div class="toggle-option" data-type="vehicle">By Vehicle</div>
                </div>

                <div class="input-group mb-3">
                    <input type="text" id="searchInput" class="form-control" placeholder="Enter Number...">
                    <button id="searchBtn" class="btn btn-primary" style="margin-top: 0; width: auto;">Track</button>
                </div>

                <div id="trackingResult"></div>
            </div>

            <div class="card-box mt-3">
                <div class="section-title">Timetable</div>
                <form id="timetableForm">
                    <div class="input-group mb-2">
                        <input type="text" id="timetableFrom" list="stationList" class="form-control" placeholder="From"
                            required>
                    </div>
                    <div class="input-group mb-2">
                        <input type="text" id="timetableTo" list="stationList" class="form-control" placeholder="To"
                            required>
                    </div>
                    <button type="submit" class="btn btn-outline-dark w-100">Check Timetable</button>
                </form>
                <div id="timetableResult" class="mt-3"></div>
            </div>
        </div>

    </div>

    <!-- TAB SWITCHING LOGIC (Simple inline for UI state) -->
    <script>
        function switchTab(tabName) {
            // Stop live tracking if switching away
            if (typeof trackingInterval !== 'undefined' && trackingInterval) {
                clearInterval(trackingInterval);
            }

            // Hide all tabs
            document.getElementById('tab-search').style.display = 'none';
            document.getElementById('tab-routes').style.display = 'none';
            document.getElementById('tab-track').style.display = 'none';

            // Deactivate all nav links
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));

            // Show selected tab
            document.getElementById('tab-' + tabName).style.display = 'block';

            // Activate selected nav link (this is a bit hacky selector but works for demo)
            event.currentTarget.classList.add('active');
        }

        // Toggle logic for Service/Vehicle
        document.querySelectorAll('.toggle-option').forEach(opt => {
            opt.addEventListener('click', function () {
                document.querySelectorAll('.toggle-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="/static/main_bundle.js?v=4.2"></script>
</body>

</html>